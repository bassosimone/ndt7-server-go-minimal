<!doctype html>
<html lang="en">
<head>
  <script type="text/javascript" src="ndt7-core.js"></script>
  <script type="text/javascript">
    /* jshint esversion: 6, asi: true */
    function runTest(testName, callback) {
      const url = window.location
      const config = {
        baseURL: url.origin + url.pathname,
        onstarting: function () {
          console.log(testName + ": starting")
        },
        onmeasurement: function (ev) {
          console.log(ev)
          if (ev.AppInfo === undefined) {
            return
          }
          const ai = ev.AppInfo
          let speed = (8 * ai.NumBytes) / (ai.ElapsedTime / 1e06)  // bit/s
          speed /= 1e06  // Mbit/s
          const elem = document.getElementById(testName)
          elem.innerHTML = speed.toFixed(2) + " Mb/s"
        },
        oncomplete: function() {
          console.log(testName + ": complete")
          if (callback !== undefined) {
            callback()
          }
        },
        testName: testName,
        userAcceptedDataPolicy: document.getElementById("accepted").checked === true,
      }
      try {
        ndt7.run(config)
      } catch (error) {
        alert(error)
      }
    }
    function runBoth() {
      runTest("download", function () {
        runTest("upload")
      })
    }
  </script>
  <meta charset="utf-8">
  <title>ndt7 Speed Test</title>
</head>
<body>
  <h2>Test Your Speed</h2>
  <div>M-Lab's Speed Test provides advanced diagnostics of
    the performance of your broadband connection through quick measurements.</div>
  <div>
    <input type="checkbox" id="accepted">
    <label>I agree to the <a href="https://www.measurementlab.net/privacy/">data
        policy</a>, which includes retention and publication of IP addresses.</label>
  </div>
  <a href="#" onclick="runBoth()">Run</a>
  <div>For more on M-Lab's data collection and measurement, including the disclosure
    of IP addresses, see our <a href="https://www.measurementlab.net/privacy/">Privacy
      Policy</a>.</div>
  <hr/>
  <h2>Results</h2>
  <div><table>
    <tr><td>download:</td><td id="download">[download]</td></tr>
    <tr><td>upload:</td><td id="upload">[upload]</td></tr>
  </table></div>
  <hr/>
  <h2>About</h2>
    <div>Measurement Lab (M-Lab) provides the largest collection of open
      Internet performance data on the planet. As a consortium of research,
      industry, and public-interest partners, M-Lab is dedicated to providing
      an ecosystem for the open, verifiable measurement of global network
      performance.</div>
    <a href="https://www.measurementlab.net/">Learn more</a>.
</body>
</html>
